---
import Modal from "@/components/Modal.astro";
import AllSkillsList from "@/components/AllSkillsList.astro";
import { Icon } from "astro-icon/components";

const modalId = "skillsModal";
---

<button
  title="Highlight my skills"
  aria-label="Highlight my skills"
  class={Astro.props.class}
  id={`open-modal:${modalId}`}
>
  <Icon name="ri:brush-fill" class="size-5" />
</button>

<Modal modalId={modalId} title="Highlight Skills">
  <div slot="body" class="space-y-3">
    <p>
      Highlight the skills you're interested in to emphasize them on the
      website.
    </p>
    <AllSkillsList class="space-y-3" input={true} />
  </div>
  <div slot="footer" class="flex items-center justify-center space-x-6">
    <button
      id="skills-check-all-btn"
      class="btn-primary"
      aria-label="Select all skills"
    >
      Select All
    </button>
    <button
      id="skills-uncheck-all-btn"
      class="btn-primary"
      aria-label="Deselect all skills"
    >
      Deselect All
    </button>
  </div>
</Modal>

<script>
  function updateChildStyle(checkbox: HTMLInputElement) {
    const skillStyle = checkbox.checked ? "true" : "false";
    [...document.getElementsByClassName("child-" + checkbox.id)].forEach(
      (element) => element.setAttribute("data-checked", skillStyle),
    );
  }

  document.addEventListener("DOMContentLoaded", () => {
    const selectAllBtn = document.getElementById(
      "skills-check-all-btn",
    ) as HTMLButtonElement;
    const deselectAllBtn = document.getElementById(
      "skills-uncheck-all-btn",
    ) as HTMLButtonElement;
    const modalSkillBoxes = [
      ...document.querySelectorAll(".input-skill-box"),
    ] as HTMLInputElement[];
    const childSkillBoxes = [
      ...document.querySelectorAll(".child-skill-box"),
    ] as HTMLElement[];

    const toggleCheckboxes = (checked: boolean) => {
      modalSkillBoxes.forEach((checkbox) => (checkbox.checked = checked));
      childSkillBoxes.forEach((element) => {
        element.setAttribute("data-checked", checked ? "true" : "false");
      });
    };
    selectAllBtn.addEventListener("click", () => toggleCheckboxes(true));
    deselectAllBtn.addEventListener("click", () => toggleCheckboxes(false));
    modalSkillBoxes.forEach((checkbox) => {
      updateChildStyle(checkbox);
      checkbox.addEventListener("change", () => {
        updateChildStyle(checkbox);
      });
    });
  });
</script>
